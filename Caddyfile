{
  order rate_limit before reverse_proxy
}

dariolab.com, www.dariolab.com {
  log {
    output file /var/log/caddy/access.log {
      roll_size 10MiB
      roll_keep 10
    }
    format json
  }

  header {
    Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    X-Frame-Options "DENY"
    X-Content-Type-Options "nosniff"
    -Server
  }

  rate_limit {
    zone per_ip_app {
      match {
        path /api-stress-test/* /ichiro-family-tree/* /shortly/* /ichiro-walks/* /portainer/*
      }
      key    {remote_host}
      events 50
      window 10s
    }
  }

  reverse_proxy gateway:8080
}